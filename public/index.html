<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Cassandra</title>
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/beige.css" id="theme">
	<link rel="stylesheet" href="css/custom.css">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/solarized-light.min.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	<script>
		function vidplay() {
			var video = document.getElementById("Video1");
			if (video.paused) {
				video.play();
			}
		}
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<!-- Partie 1 - Intro -->
			<section>
				<section>
					<h1>Cassandra</h1>
					<h2 style="font-size: larger">Une base de données taillée pour le big data</h2>
					<br>
					<h4 style="font-size: xx-large">Michel Barret, Pierre Bourret</h4>
					<h4 style="font-size: xx-large">&mdash; Viseo Technologies &mdash;</h4>
					<br>
					<img src="img/viseotechanhour.png">
					<aside class="notes">
						<h2>Pierre</h2>
					</aside>
				</section>

				<section>
					<img class="plain" src="img/you_are_here.png" height="150">
					<h3>Qu'est-ce qu'on fait ici ?</h3>
					<ul>
						<li>Technologie</li>
						<li>Cas d'utilisation</li>
						<li class="fragment grow highlight-blue">Retour d'expérience</li>
					</ul>
					<aside class="notes">
						<h2>Pierre</h2>
						Objectifs du Tech an hour:
						<ol>
							<li><em>Découvrir</em> une techno. Pas le temps d'approfondir.</li>
							<li><em>Appliquer</em> sur un cas "réel". simplifié pour l'exemple.</li>
							<li><em>Partager</em> l'expérience. Comment elle nous a servi? Ce qu'on en retient de bien, de moins bien</li>
						</ol>
					</aside>
				</section>
			</section>

			<!-- Partie 2 - Présentation globale Cassandra -->
			<section>
				<section>
					<h2>Apache Cassandra</h2>
					<img src="img/cassandra-logo.png" class="plain" width="300">
					<p tagcloud>
						<span tagcloud-weight="9">#Elastic</span>
						<span tagcloud-weight="15">#NoSQL</span>
						<span tagcloud-weight="12">#Scalability</span>
						<span tagcloud-weight="14">#Peer to Peer</span>
						<span tagcloud-weight="13">#Large row</span>
						<span tagcloud-weight="7">#Replication</span>
						<span tagcloud-weight="12">#High Availability</span>
						<span tagcloud-weight="8">#Decentralized</span>
						<span tagcloud-weight="6">#Performant</span>
						<span tagcloud-weight="10">#Fault tolerant</span>
					</p>
					<aside class="notes">
						<h2>Michel</h2>
						TODO
					</aside>
				</section>
				<section>
					<h2>Cluster</h2>
					<img class="stretch" src="img/clustering.png" />
					<!--video class="stretch" utoplay="true" controls="controls">
						<source src="video/cake.mp4" type="video/mp4" />
					</video-->
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<h2>Partitionnement</h2>
					<!--img class="stretch" src="img/clustering.png" /-->
					<video id="Video1" onshow="vidplay()" class="stretch" loop autoplay="true">
						<source src="video/cake.mp4" type="video/mp4" />
					</video>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
			</section>

			<!-- Partie 3 - Présentation du cas d'utilisation -->
			<section>
				<section>
					<h2>Fournisseur de données météo</h2>
					<table class="custom center">
						<tr>
							<td><img src="img/station-meteo.jpg"/></td>
							<td><img src="img/station-meteo2.jpg"></td>
							<td><img src="img/station-meteo3.png"></td>
							<td><img src="img/station-meteo-sea.jpg"/></td>
							<td><img src="img/meteosat.jpg"/></td>
						</tr>
					</table>

					<ul>
						<li>
							<em>Divers</em> capteurs
							<span class="fragment" style="color: red;" data-fragment-index="1">&rArr; Données hétérogènes</span>
						</li>
						<li>
							<em>Large</em> couverture
							<span class="fragment" style="color: red;" data-fragment-index="1">&rArr; Données nombreuses</span>
						</li>
						<li>
							<em>Longue</em> conservation
							<span class="fragment" style="color: red;" data-fragment-index="1">&rArr; Données <u>très</u> nombreuses</span>
						</li>
					</ul>
					<aside class="notes">
						<h2>Pierre</h2>
						TODO
						<!--h2>Recueillir les données de toutes les stations météo du territoire</h2-->
						<!--
						- satélite
						- bouée
						- station mobile (bateau)
						-->
						<!--
                            - point de rosée
                            - direction du vent
                            - pluviométrie
                        -->
					</aside>
				</section>

				<section>
					<h2>Contexte</h2>
					<img class="stretch" src="img/diagram.png" />
					<aside class="notes">
						<h2>Michel</h2>
						TODO
					</aside>
				</section>
			</section>

			<!-- Partie 4 - Présentation de la solution -->
			<section>
				<section>
					<h2>Principales requêtes</h2>
					<ul>
						<li>Quelles sont les données reçues <span class="fragment highlight-blue" data-fragment-index=3>hier</span> dans le
							<span class="fragment highlight-blue" data-fragment-index=3>bassin grenoblois</span> ?
							<span class="fragment highlight-red" data-fragment-index=3>70 %</span></li>
						<li>Quelles sont les données reçues <span class="fragment highlight-blue" data-fragment-index=3>hier</span>
							depuis une <span class="fragment highlight-blue" data-fragment-index=3>station donnée</span>?
							<span class="fragment highlight-red" data-fragment-index=3>30 %</span></li>
					</ul>
					<aside class="notes">
						<h2>Pierre</h2>
						TODO
					</aside>
				</section>
				<section>
					<h2>Clef primaire</h2>
					<ul>
						<li><b>PARTITION KEY</b></li>
						<li><b>CLUSTERING KEY</b> identification au sein de la partition</li>
					</ul>
					<pre>
					<code data-trim>
// implémentation

CREATE TABLE station (
	zone text,
	day int,
	station_id text,
	event_time timestamp,
	sensor1 sensor,

	PRIMARY KEY(<span style="color: #1b91ff!">(zone, day)</span>, station_id, event_time)
);</code>
					</pre>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					<!-- description de la clef composite, de son impact, du sharding que ça décrit -->
					</aside>
				</section>
				<section>
					<h2>Requêtes</h2>
					<pre>
					<code data-trim>
SELECT *
FROM station
WHERE zone = 'ZONE1'
  AND day = 1234
  AND station_id = 'station1'
  AND event_time = 123456789; // -> OK

SELECT *
FROM station
WHERE zone = 'ZONE1'
	AND station_id = 'station1'
	AND event_time = 123456789; // -> KO
</code>
					</pre>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					<!-- description de la clef composite, de son impact, du sharding que ça décrit -->
					</aside>
				</section>
				<section>
					<h2>Clef de partitionnement</h2>
					<ul>
						<li>Doit être invariable et déductible</li>
						<li>Doit discriminer</li>
						<li>Devrait être métier</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<img class="plain" src="img/warning.png" height="250">
					<h3>Difficulté de connaître les requêtes à l'avance</h3>
					<ul>
						<li class="fragment"><em>Monitorer</em>: usages, performances, shards</li>
						<li class="fragment">Rester ouvert aux <em>changements</em></li>
						<li class="fragment"><em>Toujours respecter les contraintes de clé primaire</em></li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					<!-- description de la clef composite, de son impact, du sharding que ça décrit -->
					</aside>
				</section>
			</section>

				<!-- Part 2 -->
			<section>
				<section>
					<h2>Données des stations</h2>
					<ul>
						<li>grand nombre de capteurs différents</li>
						<li>stockage d'image</li>
					</ul>
					<img src="img/satellite.jpg" class="stretch"/>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					<!-- expliquer que l'on utilise une colonne par capteur et pas par type de capteur, on peut mettre une grosse image dans une colonne sans souci -->
					</aside>
				</section>
				<section>
					<p>Stocker les données de chaque capteurs dans une colonne</p>
					<ul>
						<li>cassandra propose jusqu'à 2 milliards de colonnes par partition</li>
						<li>les <i>User Defined Type</i> permettent de stocker des données complexes</li>
						<li>chaque cellule peut stocker jusqu'à 2Gio</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<pre>
						<code>
CREATE TYPE sensor (
	pressure int,
	hygrometry int
);

CREATE TABLE station (
	zone text,
	day int,
	station_id text,
	event_time timestamp,
	sensor1 sensor,

	PRIMARY KEY((zone, day), station_id, event_time)
);
</code>
</pre>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
</section>
<section>
<pre>
	<code>

INSERT INTO mykeyspace.stations (zone, day, station_id,
                                 event_time)
VALUES (
	'A',
	15,
	'station456',
	123456789,
	{'pressure':12,'hygrometry':4}
);
						</code>
					</pre>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
			</section>

			<section>
				<section>
					<h2>Déploiement</h2>
					<ul>
						<li>Haute disponibilité</li>
						<li>Gros volume de données (rétention infinies, centaines de stations)</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<!-- Dessin d'un cluster -->
				<section>
					<img class="stretch" src="img/cluster.svg" />
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<img class="stretch" src="img/france.svg" />
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<ul>
						<li>Apache Cassandra n'est pas élatique !</li>
						<li>1 seul nœud c'est mal</li>
						<li>beaucoup de resources</li>
						<li>Master/Master ? P2P !</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<h2>Consistence des données</h2>
					<ul>
						<li><code>ONE</code></li>
						<li><code>QUORUM</code></li>
						<li><code>ALL</code></li>
						<li>versions locales au DC, ex: <code>LOCAL_QUORUM</code></li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<!-- description de l'organisation du cluster, du facteur de réplication -->
			</section>

			<section>
				<section>
					<h2>Qualité de la donnée</h2>
					<ul>
						<li>
							Normalisation des données
							<ul>
								<li>Alignement</li>
								<li>Ajustements, corrections</li>
							</ul>
						</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<ol>
						<li>
							Pre-processing
							<ul>
								<li>avant insertion dans Cassandra</li>
								<li>hors-contexte</li>
								<li>&rArr; <code>TRIGGER</code> (Java class)</li>
								<li>pas forcément recommandé</li>
							</ul>
						</li>
						<li>
							Batch processing
							<ul>
								<li>Affinage des données</li>
								<li>En tâche de fond</li>
								<li>&rArr; Spark</li>
								<li>Intégration très naturelle</li>
							</ul>
						</li>
					</ol>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
			</section>

			<section>
				<section>
					<h2>Requêter autrement</h2>
					<ul>
						<li>Accéder à tous les relevés dans une certaine zone</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<h2>Vue matérialisée</h2>
<pre>
	<code>
CREATE MATERIALIZED VIEW station_by_type
AS SELECT type, zone, station_id
FROM station
WHERE type IS NOT NULL
PRIMARY KEY (type, zone)
WITH comment = 'Based on table station' ;
	</code>
</pre>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
				<section>
					<h2>Index externe</h2>
					<ul>
						<li>Elastic Search, Apache Solr, Apache Lucene, ...</li>
						<li><em>Limites</em> des clés de Cassandra</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
			</section>

			<section>
                <section>
                    <h2>Vous en voulez plus ?</h2>
                    <ul>
                        <li>
                            Clusters "premium" ou dédiés
                            <ul>
                                <li>Moins de charge</li>
                                <li>Géographiquement plus près du/des clients</li>
                            </ul>
                        </li>
                        <li>
							Stratégie de réplication/placement "custom"
							<ul>
								<li>étendre <code>AbstractReplicationStrategy</code></li>
								<li>étendre <code>IEndpointSnitch</code></li>
							</ul>
						</li>
                    </ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
                </section>
			</section>

			<!-- conclusion -->
			<section>
				<section>
					<img src="img/datastax-logo.png" class="plain" width="400">
					<br>
					<br>
					<ul>
						<li>
							Cours gratuits en ligne<br>
							<a href="https://academy.datastax.com/courses">https://academy.datastax.com/courses</a>
						</li>
						<br>
						<li>
							DataStax Days Paris 2016
							<br>
							<a href="http://blog.viseo-bt.com/datastax-day-paris-2016/">http://blog.viseo-bt.com/datastax-day-paris-2016/</a>
						</li>
					</ul>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>

				<section>
					<h2>Gros poissons !</h2>
					<br>
					<table class="custom center">
						<tr>
							<td><img class="plain" src="img/apple.png" height="150"></td>
							<td><img class="plain" src="img/netflix.png"></td>
							<td><img class="plain" src="img/walmart.png"></td>
						</tr>
						<tr>
							<td><img class="plain" src="img/sony.png"></td>
							<td><img class="plain" src="img/ubs.png"></td>
							<td><img class="plain" src="img/mcdonalds.png" height="180"></td>
						</tr>
					</table>
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>

				<section>
					<h1>Questions</h1>
					<img src="img/question.png" class="plain">
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>

				<section>
					<h1>Merci !</h1>
					<img src="img/applause.gif" class="plain" height="350">
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>

				<section>
					<h2>Au prochain épisode...</h2>
					<img class="plain stretch" src="img/flyer_securite_head.png">
					<aside class="notes">
						<h2>Qui?</h2>
						TODO
					</aside>
				</section>
			</section>
		</div>
	</div>
	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// Required, even if empty.
		Reveal.initialize({
            dependencies: [
                { src: 'plugin/notes/notes.js', async: true },
                { src: 'plugin/tagcloud/tagcloud.js', async: true }
            ],
            // slideNumber: 'c/t', // Absolute slide numbers (with total).
            slideNumber: true, // Enable hierarchical slide numbers
            history: true // Enable slide number in URL fragment
		});
		// Automatic fragment numbering
var fragmentNumbering = function ( event ) {
  var fragments = $(event.currentSlide).find('.fragment');
  var order = new Array(fragments.length);
  
  $(fragments).filter('[data-index]').each( function () { 
    var index = parseInt($(this).attr('data-index')) - 1;
    if (index < 0 || index >= order.length) {
      alert('Invalid data-index: ' + index);
      return;
    }
    if (typeof order[index] == 'undefined') {
      order[index] = [ $(this) ];
    } else {
      order[index].push($(this));
    }
  });
  
  var index = 0;
  $(fragments).not('[data-index]').each( function () {
    while(typeof order[index] != 'undefined') {
      index = index + 1;
    }
    order[index] = [ $(this) ];
  });
  
  $(order).each( function (index) {
    $(this).each( function () { 
      $(this).attr('data-fragment-index', index);
    })
  });
};
Reveal.addEventListener('ready', fragmentNumbering);
Reveal.addEventListener('slidechanged', fragmentNumbering);
	</script>
</body>
</html>
