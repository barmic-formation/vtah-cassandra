<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Cassandra</title>
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/beige.css" id="theme">
	<link rel="stylesheet" href="css/custom.css">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/solarized-light.min.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h1>Cassandra</h1>
				<h2>Une base de données taillée pour le big data</h2>
				<img src="viseotechanhour.png">
			</section>

			<!-- Démarrage -->
			<section>
				<section>
					<h2>Qu'est-ce qu'on fait ici ?</h2>
					<ul>
						<li>Technologie</li>
						<li>Cas d'utilisation</li>
						<li class="fragment grow">Retour d'expérience</li>
					</ul>
					<aside class="notes">
						Objectifs du Tech an hour:
						1. Découvrir une techno. Pas le temps d'approfondir.
						2. Comment l'utiliser sur un cas "réel", simplifié pour l'exemple.
						3. Comment elle nous a servi? Ce qu'on en retient de bien, de moins bien.
					</aside>
				</section>

				<section>
					<h2>Apache Cassandra</h2>
					<img src="cassandra-logo.png" class="plain" width="300">
					<p tagcloud>
						Large row
						Peer to Peer
						Decentralized
						Scalability
						Fault tolerant
						Replication
						Multi data-center
						High Availability
						Made for Facebook
						NoSQL
						Performant
						Durable
						Elastic
					</p>
				</section>
			</section>

			<!-- Présentation du cas -->

			<section>
				<section>
					<!--h2>Recueillir les données de toutes les stations météo du territoire</h2-->
					<img class="stretch" src="station-meteo.jpg" />
					<!--
						- satélite
						- bouée
						- station mobile (bateau)
					-->
					<!--
						- point de rosée
						- direction du vent
						- pluviométrie
					-->
				</section>

				<section>
					<img class="stretch" src="diagram.png" />
				</section>

				<section>
					<h2>Besoins</h2>
					<ul>
						<li>cluster réparti en france (+DOM/TOM) avec un gros cluster en île de France</li>
						<li>volumétrie</li>
						<li>hétérogénéité des données</li>
					</ul>
				</section>
			</section>

			<!-- Présentation de la solution -->
			<section>
				<!-- Part 1 -->
				<section>
					<h2>Principales requètes</h2>
					<ul>
						<li>Quelles sont les données reçues hier dans le bassin grenoblois ?</li>
						<li>Quelles sont les données reçues depuis une central reçues hier dans le bassin grenoblois ?</li>
					</ul>
				</section>
				<section>
					<h2>Principales requètes</h2>
					<ul>
						<li>Quelles sont les données reçues <span class="highlight-blue">hier</span> dans le <span class="highlight-blue">bassin grenoblois</span> ? <span class="highlight-red">70 %</span></li>
						<li>Quelles sont les données reçues depuis une central reçues <span class="highlight-blue">hier</span> dans le <span class="highlight-blue">bassin grenoblois</span> ? <span class="highlight-red">30 %</span></li>
					</ul>
				</section>
				<section>
					<h2>Choix de la clef</h2>
					<ul>
						<li><b>PARTITION KEY</b></li>
						<li><b>CLUSTERING KEY</b> identification au sein de la partition</li>
					</ul>
					<pre>
					<code data-trim>
CREATE TABLE station (
	zone text,
	day int,
	station_id text,
	event_time timestamp,
	sensor1 sensor,

	PRIMARY KEY((zone, day), station_id, event_time)
);</code>
					</pre>
					<!-- description de la clef composite, de son impact, du sharding que ça décrit -->
				</section>
				<section>
					<h2>Clef de partitionnement</h2>
					<ul>
						<li>Doit être invariant et déductible pour une donnée</li>
						<li>Doit discriminer correctement les données</li>
						<li>Devrait permettre une colocalisation des accès/traitements</li>
					</ul>
				</section>
				<section>
					Difficulté de connaître les requêtes à l'avance
					<ul>
						<li class="fragment">Monitorer</li>
						<li class="fragment">Rester ouvert aux changements</li>
					</ul>
					<!-- description de la clef composite, de son impact, du sharding que ça décrit -->
				</section>
			</section>

				<!-- Part 2 -->
			<section>
				<section>
					<h2>Données des stations</h2>
					<ul>
						<li>grand nombre de capteurs différents</li>
						<li>stockage d'image</li>
					</ul>
					<!-- expliquer que l'on utilise une colonne par capteur et pas par type de capteur, on peut mettre une grosse image dans une colonne sans souci -->
				</section>
				<section>
					<p>Stocker les données de chaque capteurs dans une colonne</p>
					<ul>
						<li>cassandra propose jusqu'à 2M colonnes</li>
						<li>les <i>User Defined Type</i> permettent de stocker des données complexes</li>
						<li>chaque cellule peut stocker jusqu'à 2Gio</li>
					</ul>
				</section>
				<section>
					<pre>
						<code>
CREATE TYPE sensor (
	pressure int,
	hygrometry int
);

CREATE TABLE station (
	zone text,
	day int,
	station_id text,
	event_time timestamp,
	sensor1 sensor,

	PRIMARY KEY((zone, day), station_id, event_time)
);

INSERT INTO mykeyspace.stations (zone, day, station_id, event_time)
VALUES ('A', 15, 'station456', 123456789, {'pressure':12,hygrometry:4});
						</code>
					</pre>
				</section>
			</section>

			<section>
				<section>
					<h2>Déploiement</h2>
					<ul>
						<li>Haute disponibilité</li>
						<li>Gros volume de données (rétention infinies, centaines de stations)</li>
					</ul>
				</section>
				<!-- Dessin d'un cluster -->
				<section>
					<img class="stretch" src="cluster.svg" />
				</section>
				<section>
					<img class="stretch" src="france.svg" />
				</section>
				<section>
					<ul>
						<li>Apache Cassandra n'est pas élatique !</li>
						<li>1 seul nœud c'est mal</li>
						<li>beaucoup de resources</li>
					</ul>
				</section>
				<!-- description de l'organisation du cluster, du facteur de réplication -->
			</section>

			<section>
				<section>
					<h2>Qualité de la donnée</h2>
					<ul>
						<li>
							Normalisation des données
							<ul>
								<li>Alignement</li>
								<li>Ajustements, corrections</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
					<ol>
						<li>
							Pre-processing
							<ul>
								<li>avant insertion dans Cassandra</li>
								<li>hors-contexte</li>
								<li>&rArr; <code>TRIGGER</code></li>
							</ul>
						</li>
						<li>
							Batch processing
							<ul>
								<li>Affinage des données</li>
								<li>En tâche de fond</li>
								<li>&rArr; Spark</li>
							</ul>
						</li>
					</ol>
				</section>
				<section>
					<h2>Consistence des données</h2>
					<ul>
						<li><code>ONE</code></li>
						<li><code>QUORUM</code></li>
						<li><code>ALL</code></li>
						<li>versions locales au DC, ex: <code>LOCAL_QUORUM</code></li>
					</ul>
				</section>
			</section>

			<section>
				<section>
					<h2>Requêter autrement</h2>
					<ul>
						<li>Accéder à tous les relevés dans une certaine zone</li>
					</ul>
				</section>
				<section>
					<ul>
						<li>Vue matérialisée</li>
						<li>
							Index externe, moteur de recherche
							<ul>
								<li>Elastic Search, Apache Solr, Apache Lucene, ...</li>
								<li><em>Limites</em> des clés de Cassandra</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
					<h2>Vue matérialisée</h2>
<pre>
	<code>
CREATE MATERIALIZED VIEW station_by_type
AS SELECT type, zone, station_id
FROM station
WHERE type IS NOT NULL
PRIMARY KEY (type, zone)
WITH comment = 'Based on table station' ;
	</code>
</pre>
				</section>
			</section>

			<section>
                <section>
                    <h2>Mise à disposition des données</h2>
                    <ul>
                        <li>Garantie d'accès aux clients importants</li>
                        <li>Sandbox pour expérimentations</li>
                    </ul>
                </section>
                <section>
                    <h2>Duplication Cluster</h2>
                    <ul>
                        <li>
                            Clusters "premium" ou dédiés
                            <ul>
                                <li>Moins de charge</li>
                                <li>Géographiquement plus près du/des clients</li>
                            </ul>
                        </li>
                        <li>
							Stratégie de réplication/placement "custom"
							<ul>
								<li>étendre <code>AbstractReplicationStrategy</code></li>
								<li>étendre <code>IEndpointSnitch</code></li>
							</ul>
						</li>
                    </ul>
                </section>
			</section>

			<!-- conclusion -->
			<section>
				<a href="http://blog.viseo-bt.com/datastax-day-paris-2016/">Datastax day paris 2016</a>
			</section>
		</div>
	</div>
	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// Required, even if empty.
		Reveal.initialize({
            dependencies: [
                { src: 'plugin/tagcloud/tagcloud.js', async: true }
            ],
            // slideNumber: 'c/t', // Absolute slide numbers (with total).
            slideNumber: true, // Enable hierarchical slide numbers
            history: true // Enable slide number in URL fragment
		});
	</script>
</body>
</html>
