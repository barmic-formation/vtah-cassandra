<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Cassandra</title>
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/beige.css" id="theme">
	<link rel="stylesheet" href="css/custom.css">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/solarized-light.min.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h1>Cassandra</h1>
				<h2>Une base de données taillée pour le big data</h2>
				<img src="viseotechanhour.png">
			</section>

			<!-- Démarrage -->
			<section>
				<section>
					<h1>Qu'est-ce qu'on fait ici ?</h1>
					<!-- objectifs de la présentation -->
					<ul>
						<li>Technologie</li>
						<li>Cas d'utilisation</li>
						<li><em>Retour d'expérience</em></li>
					</ul>
				</section>

				<section>
					<h1>Apache Cassandra</h1>
					<ul>
						<li class="todo">Tagcloud plugin</li>
						<li>large row</li>
						<li>pair à pair</li>
						<li>HA</li>
						<li>made for Facebook</li>
						<li>NoSQL</li>
					</ul>
				</section>


			</section>

			<!-- Présentation du cas -->

			<section>
				<section>
					<!--h2>Recueillir les données de toutes les stations météo du territoire</h2-->
					<img class="stretch" src="station-meteo.jpg" />
					<!--
						- satélite
						- bouée
						- station mobile (bateau)
					-->
					<!--
						- point de rosée
						- direction du vent
						- pluviométrie
					-->
				</section>

				<section>
					<img class="stretch" src="diagram.png" />
				</section>

				<section>
					<h2>Besoins</h2>
					<ul>
						<li>cluster réparti en france (+DOM/TOM) avec un gros cluster en île de France</li>
						<li>volumétrie</li>
						<li>hétérogénéité des données</li>
					</ul>
				</section>
			</section>

			<!-- Présentation de la solution -->
			<section>
				<!-- Part 1 -->
				<section>
					<h2>Principales requètes</h2>
					<ul>
						<li>Quelles sont les données reçues <span class="fragment highlight-blue">hier</span> dans le <span class="fragment highlight-blue">bassin grenoblois</span> ? <span class="fragment">70 %</span></li>
						<li>Quelles sont les données reçues depuis une central reçues <span class="fragment highlight-blue">hier</span> dans le <span class="fragment highlight-blue">bassin grenoblois</span> ? <span class="fragment">30 %</span></li>
					</ul>
				</section>
				<section>
					<h2>Choix de la clef</h2>
					<ul>
						<li><b>PARTITION KEY</b></li>
						<li><b>CLUSTERING KEY</b> identification au sein de la partition</li>
					</ul>
					<pre>
					<code data-trim>PRIMARY KEY((zone, day), station_id, event_time)</code>
					</pre>
					<!-- description de la clef composite, de son impact, du sharding que ça décrit -->
				</section>
				<section>
					<h2>Choix d'une clef de partitionnement</h2>
					<ul>
						<li>Doit être invariant pour une donnée</li>
						<li>Doit discriminer correctement les données</li>
						<li>Devrait permettre une colocalisation des accès/traitement</li>
					</ul>
				</section>
				<section>
					<h2></h2>
					Difficulté de connaître les requêtes à l'avance
					<ul>
						<li class="fragment">Monitorer</li>
						<li class="fragment">Rester ouvert aux changements</li>
					</ul>
					<!-- description de la clef composite, de son impact, du sharding que ça décrit -->
				</section>
			</section>

				<!-- Part 2 -->
			<section>
				<section>
					<h2>Données des stations</h2>
					<ul>
						<li>grand nombre de capteurs différents</li>
						<li>stockage d'image</li>
					</ul>
					<!-- expliquer que l'on utilise une colonne par capteur et pas par type de capteur, on peut mettre une grosse image dans une colonne sans souci -->
				</section>
				<section>
					<p>Stocker les données de chaque capteurs dans une colonne</p>
					<ul>
						<li>cassandra propose jusqu'à 2M colonnes</li>
						<li>les <i>User Defined Type</i> permettent de stocker des données complexes</li>
						<li>chaque cellule peut stocker jusqu'à 2Gio</li>
					</ul>
				</section>
				<section>
					<pre>
						<code>
CREATE TYPE sensor (
	pressure int,
	hygrometry int
);
CREATE TABLE station (
	zone text,
	day int,
	station_id text,
	station_id timestamp,
	sensor1 sensor,

	PRIMARY KEY((zone, day), station_id)
);

INSERT INTO mykeyspace.stations (zone, day, station_id, event_time)
VALUES ('A', 15, 'station456', 123456789, {'pressure':12,hygrometry:4});
						</code>
					</pre>
				</section>
			</section>

			<section>
				<section>
					<h2>Déploiement</h2>
					<!-- besoin -->
					<h3>Besoin</h3>
					<ul>
						<li>Haute disponibilité</li>
						<li>Gros volume de données (rétention infinies, centaines de stations)</li>
					</ul>
				</section>
				<!-- Dessin d'un cluster -->
				<section>
					<img class="stretch" src="cluster.svg" />
				</section>
				<section>
					<img class="stretch" src="france.svg" />
				</section>
				<section>
					<ul>
						<li>Apache Cassandra n'est pas élatique !</li>
						<li>1 seul nœud c'est mal</li>
						<li>beaucoup de resources</li>
					</ul>
				</section>
				<!-- description de l'organisation du cluster, du facteur de réplication -->
			</section>
			<section>
				<h2>Qualité de la donnée</h2>
				<!-- besoin de faire de la normalisation de données au vol et en batch -->
				<!-- impact sur la politique d'écriture -->
			</section>
			<section>
				<h2>Présentation des données</h2>
				<!-- utilisation d'index extérieur -->
				<!-- création de cluster spécifiques pour des clients -->
				<!-- possibilité d'utiliser des vues matérialisées -->
			</section>

			<section>
				<section>
					<h1>4. Qualité de la donnée</h1>
				</section>
				<section>
					<h2>Besoins:</h2>
					<ul>
						<li>
							Normalisation des données
							<ul>
								<li>Alignement</li>
								<li>Ajustements, corrections</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
					<h2>Solution:</h2>
					<ol>
						<li>
							Pre-processing
							<ul>
								<li>avant insertion dans Cassandra</li>
								<li>hors-contexte</li>
								<li>&rArr; <code>TRIGGER</code></li>
							</ul>
						</li>
						<li>
							Batch processing
							<ul>
								<li>Affinage des données</li>
								<li>En tâche de fond</li>
								<li></li>
								<li>&rArr; Spark</li>
							</ul>
						</li>
					</ol>
				</section>
				<section>
					<h2>Consistence des données</h2>
					<ul>
						<li><code>ONE</code></li>
						<li><code>QUORUM</code></li>
						<li><code>ALL</code></li>
						<li>versions locales au DC, ex: <code>LOCAL_QUORUM</code></li>
					</ul>
				</section>
			</section>

			<section>
				<section>
					<h1>5. Requêter autrement</h1>
				</section>
				<section>
					<h2>Besoins:</h2>
					<ul>
						<li>Accéder à tous les relevés dans une certaine zone</li>
					</ul>
				</section>
				<section>
					<h2>Solution:</h2>
					<ul>
						<li>Vue matérialisée</li>
						<li>
							Index externe, moteur de recherche
							<ul>
								<li>Elastic Search, Apache Solr, Apache Lucene, ...</li>
								<li><em>Limites</em> des clés de Cassandra</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
					<h2>Vue matérialisée</h2>

				</section>


			</section>


			<section>
				<section>
					<h1>6. Duplication Cluster</h1>
				</section>
                <section>
                    <h2>Besoins:</h2>
                    <ul>
                        <li>Garantie d'accès aux client importants</li>
                        <li>Sandbox pour expérimentations</li>
                    </ul>
                </section>
                <section>
                    <h2>Solution:</h2>
                    <ul>
                        <li>
                            Clusters "premium" ou dédiés
                            <ul>
                                <li>Moins de charge</li>
                                <li>Géographiquement plus près du/des clients</li>
                            </ul>
                        </li>
                        <li>
							Stratégie de réplication/placement "custom"
							<ul>
								<li>étendre <code>AbstractReplicationStrategy</code></li>
								<li>étendre <code>IEndpointSnitch</code></li>
							</ul>
						</li>
                    </ul>
                </section>
			</section>

			<!-- conclusion -->
			<section>
				<h2>Pro/Cons</h2>
				<!-- base de données très particulière -->
				<!-- parler d'iCloud ici ? -->
				<!-- rex -->
			</section>
		</div>
	</div>
	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// Required, even if empty.
		Reveal.initialize({
            dependencies: [
                { src: 'plugin/tagcloud/tagcloud.js', async: true }
            ],
            // slideNumber: 'c/t', // Absolute slide numbers (with total).
            slideNumber: true, // Enable hierarchical slide numbers
            history: true // Enable slide number in URL fragment
		});
	</script>
</body>
</html>
